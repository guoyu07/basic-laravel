machine:
  pre:
    - sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
    - sudo apt-get update
    - sudo apt-get install google-chrome-stable
  php:
    version: 7.1.0
  services:
    - mysql
  post:
    - chromedriver:
        background: true
  # database:
  #   override:
  #     - "php artisan migrate"
  #     - "php artisan db:seed"


dependencies:
  pre:
    # - composer config -g github-oauth.github.com $GITHUB_OAUTH_TOKEN
    - sudo mkdir -p /home/basic-laravel/storage/{app,framework,logs}
    - sudo mkdir -p /home/basic-laravel/storage/framework/{cache,sessions,views}
    - sudo chmod 777 -R /home/basic-laravel/storage
  override:
    - composer install --prefer-dist --no-interaction
  cache_directories:
    - ~/.composer/cache

test:
  pre:
    - cp .env.ci .env
    - php artisan config:cache
    - php artisan key:generate
    - php artisan config:cache
    - ./vendor/laravel/dusk/bin/chromedriver-linux:
              background: true
    - php artisan serve:
              background: true
  override:
    # - php security-checker.phar security:check
    #- php artisan code-sniffer
    - php vendor/bin/phpcs routes/
    - php vendor/bin/phpcs app/
    - php vendor/bin/phpcs config/
    - php artisan dusk
    - vendor/bin/phpunit -d memory_limit=512M
